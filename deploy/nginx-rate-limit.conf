# Aura Security - Nginx Rate Limiting Configuration
#
# Add this to the http block in /etc/nginx/nginx.conf:
#   include /home/ubuntu/slop-security-auditor/deploy/nginx-rate-limit.conf;
#
# Or copy the relevant sections into your existing nginx config.
#
# This limits external API abuse without affecting the Telegram/Discord bots
# (which come from AWS Lambda IPs and won't exceed these limits under normal use).

# Rate limit zones (place in http block)
# 60 requests/minute per IP for API endpoints
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=60r/m;

# 10 requests/minute per IP for scan endpoints (heavier operations)
limit_req_zone $binary_remote_addr zone=scan_limit:10m rate=10r/m;

# Apply rate limits in server/location blocks:
#
# For the /tools endpoint (where scans happen):
#   location /tools {
#       limit_req zone=scan_limit burst=5 nodelay;
#       limit_req_status 429;
#       proxy_pass http://127.0.0.1:3000;
#   }
#
# For general API endpoints:
#   location / {
#       limit_req zone=api_limit burst=20 nodelay;
#       limit_req_status 429;
#       proxy_pass http://127.0.0.1:3000;
#   }
#
# Custom 429 error page:
#   error_page 429 = @rate_limited;
#   location @rate_limited {
#       default_type application/json;
#       return 429 '{"error": "Rate limit exceeded. Try again later."}';
#   }
